<div class="plans-container active-plans-card"
     data-controller="proof-upload">

  <h2>Active Plans for Today</h2>

  <% if current_user.plans.where(status: [:created, :needs_resubmission]).any? %>
    <% current_user.plans.where(status: [:created, :needs_resubmission]).each do |plan| %>
      <div class="plan-card">
        <div class="plan-info">
          <div class="icon <%= plan.wellness_pillar %>">
            <% case plan.wellness_pillar
            when "nutrition" %> 🥗
            <% when "supplements" %> 🍽️
            <% when "hypnosis" %> 🧘
            <% when "caffeine" %> ☕
            <% when "exercise" %> 💪
            <% else %> 📋
            <% end %>
          </div>
          <div>
            <h3><%= plan.details.truncate(30) %></h3>
            <% if plan.respond_to?(:reminder_time) && plan.reminder_time.present? %>
              <p class="due">Due: <%= plan.duration&.strftime("%b %d, %I:%M %p") %></p>
            <% else %>
              <p class="due">Created: <%= plan.created_at.strftime("%b %d, %I:%M %p") %></p>
            <% end %>
          </div>
        </div>

        <% if plan.status_created? || plan.status_needs_resubmission? %>
          <button type="button"
                  class="upload-btn <%= plan.wellness_pillar.in?(%w[exercise nutrition]) ? 'blue' : 'green' %>"
                  data-action="click->proof-upload#open"
                  data-proof-upload-plan-id-param="<%= plan.id %>"
                  data-proof-upload-pillar-param="<%= plan.wellness_pillar %>">
            <%= plan.wellness_pillar.in?(["exercise", "nutrition"]) ? "📷 Submit Proof" : "Mark as Done" %>
          </button>
        <% elsif plan.proof.attached? %>
          <span>Proof uploaded</span>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p>No active plans for today.</p>
  <% end %>

  <%= render "dashboards/proof_modal" %>
</div>