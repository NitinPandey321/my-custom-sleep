<div class="submissions-container my-submissions-card" data-controller="submission">
  <h2>My Submissions</h2>

  <div class="tabs" id="submission-tabs">
    <div class="tab active"
         data-status="pending"
         data-submission-target="tab"
         data-action="click->submission#selectTab">
      Pending <span class="count"><%= @client.plans.where(status: :pending).count %></span>
    </div>
    <div class="tab"
         data-status="approved"
         data-submission-target="tab"
         data-action="click->submission#selectTab">
      Approved <span class="count"><%= @client.plans.where(status: :approved).count %></span>
    </div>
    <div class="tab"
         data-status="needs_resubmission"
         data-submission-target="tab"
         data-action="click->submission#selectTab">
      Rejected <span class="count"><%= @client.plans.where(status: :needs_resubmission).count %></span>
    </div>
  </div>

  <% plans_by_status = @client.plans.where.not(status: :created).group_by(&:status) %>
  <div id="submission-cards">
    <% ['pending', 'approved', 'needs_resubmission'].each do |status| %>
      <div class="submission-status-group"
           data-status="<%= status %>"
           data-submission-target="group"
           style="<%= status == 'pending' ? '' : 'display:none;' %>">
           
        <% if plans_by_status[status].present? %>
          <% plans_by_status[status].each do |plan| %>
            <div class="submission-card">
              <div class="submission-info">
                <div class="icon <%= plan.wellness_pillar %>">
                  <% case plan.wellness_pillar
                      when "nutrition" %> 🥗
                      <% when "supplements" %> 🍽️
                      <% when "hypnosis" %> 🧘
                      <% when "Caffeine" %> ☕
                      <% when "exercise" %> 💪
                      <% else %> 📋
                  <% end %>
                </div>
                <div>
                  <h3><%= plan.details.truncate(30) %></h3>
                  <p class="time">Uploaded <%= time_ago_in_words(plan.updated_at) %> ago</p>
                  <% if plan.proofs.attached? %>
                    <% plan.proofs.each do |proof| %>
                        <%= link_to url_for(proof), target: "_blank" do %>
                          <%= image_tag proof, alt: "Proof", style: "width:48px; height:48px; object-fit:cover; margin-right:4px; border-radius:4px; border:1px solid #ccc;" %>
                        <% end %>
                      <% end %>
                  <% end %>
                  <% if plan.status_needs_resubmission? && plan.resubmission_reason.present? %>
                    <p class="resubmission-reason"><strong>Reason:</strong> <%= plan.resubmission_reason %></p>
                  <% end %>
                </div>
              </div>
              <span class="status-badge <%= plan.status %>">
                <% if plan.status_pending? %>⏳ Pending<% end %>
                <% if plan.status_approved? %>✅ Approved<% end %>
                <% if plan.status_needs_resubmission? %>❗ Rejected<% end %>
              </span>
            </div>
          <% end %>
        <% else %>
          <p>No <%= status.to_s.humanize %> submissions.</p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
