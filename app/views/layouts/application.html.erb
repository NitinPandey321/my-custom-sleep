<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "My Sleep Journey" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="<%= asset_path('profile_picture.js') %>" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body class="logged-in" if user_signed_in? >
    <header class="app-header">
      <div class="container">
        <%
=begin%>
 <% if user_signed_in? %>
          <div class="navbar">
            <div class="navbar-left">
              <%= link_to root_path, class: "logo-link" do %>
                <div class="logo">
                  <%= image_tag "my-custom-logo.jpeg", alt: "My Custom Sleep Journey", class: "brand-logo navbar-logo" %>
                </div>
              <% end %>
            </div>
            <div class="navbar-right">
              <nav class="nav-menu">
                <div class="user-info">
                  <span class="welcome-text">Welcome, <%= current_user.email.split('@').first.capitalize %></span>
                  <div class="profile-container">
                    <% if current_user.profile_picture.attached? %>
                      <img id="profile-pic" 
                           src="<%= rails_blob_url(current_user.profile_picture, disposition: 'inline') %>" 
                           alt="Profile picture" 
                           class="profile-picture" />
                    <% else %>
                      <%= image_tag "default-avatar.svg", 
                                    alt: "Default profile picture", 
                                    id: "profile-pic",
                                    class: "profile-picture" %>
                    <% end %>
                    <label class="edit-icon" title="Change profile picture">
                      <%= link_to "âœŽ", user_path(current_user), class: "no-link-style" %>
                    </label>
                  </div>
                  <%= button_to "Logout", logout_path, 
                      method: :delete, 
                      class: "logout-btn",
                      data: { turbo: true, confirm: "Are you sure you want to logout?" } %>
                </div>
              </nav>
            </div>
          </div>
        <% end %> 
<%
=end%>
      </div>
    </header>

    <main class="main-content oasdas">
      <% if user_signed_in? %>
        <%= render "shared/sidebar" %>
      <% end %>
      <%= render 'shared/flash_messages' if flash.any? %>
      <%= turbo_stream_from "user_#{current_user.id}" if current_user %>
      <turbo-frame id="escalation_popup"></turbo-frame>
      <turbo-frame id="coach_requests"></turbo-frame>
      <div id="coach_redirect"></div>
      <div class="container-main">
        <%= yield %>
      </div>
    </main>
  </body>
</html>
