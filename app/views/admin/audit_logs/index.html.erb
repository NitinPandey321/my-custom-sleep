<div class="admin-header d-flex justify-content-between align-items-center">
  <h1>Audit Logs</h1>

  <div class="filter-form">
    <%= form_with url: admin_audit_logs_path, method: :get, local: true, class: "form-inline" do %>
      <div class="form-group mr-2">
        <%= select_tag :user_id,
          options_from_collection_for_select(@users, :id, :full_name, params[:user_id]),
          include_blank: "All Users",
          class: "form-control" %>
      </div>
      <%= submit_tag "Filter", class: "btn btn-primary" %>
      <%= link_to "Clear", admin_audit_logs_path, class: "btn btn-secondary ml-2" %>
    <% end %>
  </div>
</div>

<table class="admin-table">
  <thead>
    <tr>
      <th>User</th>
      <th>Role</th>
      <th>Action</th>
      <th>On</th>
      <th>Details</th>
      <th>Time</th>
    </tr>
  </thead>
  <tbody>
    <% @audit_logs.each do |log| %>
      <tr>
        <td><%= log.user&.full_name || "System" %></td>
        <td><%= log.role.titleize %></td>
        <td><span class="status-badge <%= log.action %>"><%= log.action.humanize %></span></td>
        <td>
          <% if log.auditable.present? %>
            <% if log.auditable_type == "Plan" %>
              <%= link_to "#{log.auditable.user.full_name}", admin_plan_path(log.auditable) %>
            <% else %>
              <%= "#{log.auditable_type}##{log.auditable_id}" %>
            <% end %>
          <% else %>
            â€“
          <% end %>
        </td>
        <td><%= log.details %></td>
        <td><%= log.created_at.strftime("%Y-%m-%d %H:%M") %></td>
      </tr>
    <% end %>
  </tbody>
</table>
