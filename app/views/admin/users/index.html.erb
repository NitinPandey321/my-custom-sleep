<div class="admin-header d-flex justify-content-between align-items-center">
  <h1>Users</h1>
  <%= form_with url: admin_users_path, method: :get, local: true, class: "d-flex align-items-center" do %>
    <%= text_field_tag :q, params[:q], placeholder: "Search by name", class: "form-control mr-2" %>
    <%= submit_tag "Search", class: "btn btn-secondary" %>
  <% end %>
  <%= link_to "New User", new_admin_user_path, class: "btn btn-primary ml-2" %>
</div>

<table class="admin-table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Score</th>
      <th>Role</th>
      <th>Active</th>
      <th>Clients</th>
      <th>Assigned Coach</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @users.each do |user| %>
      <tr>
        <td><%= user.full_name %></td>
        <td><%= user.email %></td>
        <td>
           <% if user.role == "client" %>
            <%= user.plans.count > 0 ? (user.plans.where.not(status: :created).count * 100 / user.plans.count) : 0 %>%
          <% else %>
            –
          <% end %>
        </td>
        <td><%= user.role %></td>
        <td>
          <% if user.deactivated? %>
            <span class="badge badge-danger">Inactive</span>
          <% else %>
            <span class="badge badge-success">Active</span>
          <% end %>
        </td>
        <td>
          <% if user.role == "coach" %>
            <%= user.clients.count %>
          <% else %>
            –
          <% end %>
        </td>
        <td>
          <% if user.role == "client" %>
            <%= user.coach&.full_name || "Unassigned" %>
          <% else %>
            –
          <% end %>
        </td>
        <td>
          <%= link_to "Show", admin_user_path(user), class: "btn btn-sm btn-info" %>
          <%= link_to "Edit", edit_admin_user_path(user), class: "btn btn-sm btn-warning" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
