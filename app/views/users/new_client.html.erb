<div class="auth-container" data-signup="true">
  <div class="auth-card signup-form">
    <!-- Logo Section -->
    <div class="auth-logo">
      <%= link_to root_path do %>
        <%= image_tag "my-custom-logo.jpeg", alt: "My Custom Sleep Journey", class: "brand-logo" %>
      <% end %>
    </div>

    <div class="auth-header">
      <h2>I am  Client</h2>
      <p>Start your personalized sleep journey</p>
    </div>

    <%= form_with model: @user, url: signup_client_path, local: true, 
        class: "auth-form", 
        data: { 
          controller: "form-validation",
          form_validation_target: "form",
          action: "submit->form-validation#validateForm"
        } do |form| %>
      
      <!-- Live region for screen reader announcements -->
      <div aria-live="polite" class="sr-only" data-form-validation-target="liveRegion"></div>
      
      <div class="form-row">
        <div class="input-group">
          <%= form.label :first_name, "First Name", class: "input-label" %>
          <%= form.text_field :first_name, 
              placeholder: "Enter your first name", 
              class: "form-input", 
              autocomplete: "given-name",
              data: { 
                form_validation_target: "firstNameInput"
              } %>
          <div class="validation-error" data-form-validation-target="firstNameError"></div>
        </div>
        
        <div class="input-group">
          <%= form.label :last_name, "Last Name", class: "input-label" %>
          <%= form.text_field :last_name, 
              placeholder: "Enter your last name", 
              class: "form-input", 
              autocomplete: "family-name",
              data: { 
                form_validation_target: "lastNameInput"
              } %>
          <div class="validation-error" data-form-validation-target="lastNameError"></div>
        </div>
      </div>

      <div class="form-row">
        <div class="input-group">
          <%= form.label :email, "Email", class: "input-label" %>
          <%= form.email_field :email, 
              placeholder: "Enter your email", 
              class: "form-input", 
              autocomplete: "email",
              data: { 
                form_validation_target: "emailInput"
              } %>
          <div class="validation-error" data-form-validation-target="emailError"></div>
        </div>
        
        <div class="input-group">
          <%= render 'shared/phone_input', form: form %>
        </div>
      </div>

      <div class="form-row">
        <div class="input-group">
          <%= form.label :preferred_coach_gender, "Preferred Gender for Coach", class: "input-label" %>
          <%= form.select :preferred_coach_gender, 
              options_for_select([
                ['Male', 'male'],
                ['Female', 'female']
              ], @user.preferred_coach_gender), 
              {}, 
              { 
                class: "form-input",
                data: { 
                  form_validation_target: "preferredCoachGenderInput"
                } 
              } %>
          <div class="validation-error" data-form-validation-target="preferredCoachGenderError"></div>
        </div>
        
        <div class="input-group">
          <%= form.label :gender, "Gender", class: "input-label" %>
          <%= form.select :gender, 
              options_for_select([
                ['Select Gender', ''],
                ['Male', 'male'],
                ['Female', 'female'],
                ['Other', 'other'],
                ['Prefer not to say', 'prefer_not_to_say']
              ], @user.gender), 
              {}, 
              { 
                class: "form-input",
                data: { 
                  form_validation_target: "genderInput"
                } 
              } %>
          <div class="validation-error" data-form-validation-target="genderError"></div>
        </div>
      </div>

      <div class="form-row">
        <div class="input-group">
          <%= form.label :password, "Password", class: "input-label" %>
          <%= form.password_field :password, 
              placeholder: "Create a password", 
              class: "form-input", 
              autocomplete: "new-password",
              data: { 
                form_validation_target: "passwordInput"
              } %>
          <div class="password-strength" data-form-validation-target="passwordStrength"></div>
          <div class="validation-error" data-form-validation-target="passwordError"></div>
        </div>
        
        <div class="input-group">
          <%= form.label :password_confirmation, "Confirm Password", class: "input-label" %>
          <%= form.password_field :password_confirmation, 
              placeholder: "Confirm your password", 
              class: "form-input", 
              autocomplete: "new-password",
              data: { 
                form_validation_target: "passwordConfirmationInput"
              } %>
          <div class="validation-error" data-form-validation-target="passwordConfirmationError"></div>
        </div>
      </div>

      <div class="form-actions">
        <%= form.submit "Create Client Account", 
            class: "btn btn-primary btn-full",
            data: { form_validation_target: "submitButton" } %>
      </div>
    <% end %>

    <!-- Display server-side validation errors -->
    <% if @user&.errors&.any? %>
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const controller = document.querySelector('[data-controller*="form-validation"]')?.formValidationController
          if (controller) {
            const errors = {
              <% @user.errors.each do |error| %>
                <% field_name = case error.attribute.to_s
                   when 'first_name' then 'firstName'
                   when 'last_name' then 'lastName'
                   when 'mobile_number', 'country_code', 'phone_e164', 'phone_country_iso2' then 'phone'
                   when 'password_confirmation' then 'passwordConfirmation'
                   when 'gender' then 'gender'
                   else error.attribute.to_s.camelcase(:lower)
                   end %>
                '<%= field_name %>': '<%= j(error.message) %>',
              <% end %>
            }
            controller.handleServerErrors(errors)
          }
        })
      </script>
    <% end %>

    <div class="auth-footer">
      <p>Already have an account? 
        <%= link_to "Sign in", login_path, class: "auth-link" %>
      </p>
      <p>
        <%= link_to "â† Back to role selection", signup_path, class: "auth-link" %>
      </p>
    </div>
  </div>
</div>
